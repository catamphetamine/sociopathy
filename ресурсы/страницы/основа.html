<!DOCTYPE html>
	
<html lang="ru">
	<head>
		<meta name="author" content="kuchumovn@gmail.com"> 
		<meta name="designer" content="kuchumovn@gmail.com">
		<meta name='copyright' content='2010-2011 Николай Кучумов' />
		<meta name="description" content="Собрание - необычная общественная сеть"> 
		
		<meta charset="utf-8" />

		<title>Собрание</title>

		<script src="/javascripts/jquery/jquery-1.7.js"></script>

		<script>
			var Version // ex. '1.0.0.0-aplha'
			
			function add_version(url)
			{
				if (!Version)
					throw 'Version not initialized'
				
				 return url + '?version=' + Version
			}
		</script>
			
		<script>
			var scripts =
			[
				{jquery:
				[
					'jquery.disable.text.select',
					'jquery.tmpl',
					'jquery.extension',
					'jquery.cookie',
					'jquery.color',
					'jquery.animate-shadow',
					'jquery.tools',
					'jquery-full-house',
					'jquery.easing.min.1.3',
					'jquery.i18n',
					'jquery.glow',
					'jquery.color.min',
					'jquery.mousewheel',
					'jquery.hoverattribute',
					'jquery.text-shadow',
					'jquery.background.position.x.y',
				]},
				
				{mootools:
				[
					'mootools-core-1.4.5-full-nocompat',
					'mootools-more-1.4.0.1',
				]},
				
				'язык',
				'date',
				
				'uri',
				
				'страница',
				'снасти',
				
				'dom tools',
				'клавиши',
				'прокрутка',
				
				'общее',
				
				'проверка обозревателя',
				
				'движение',
				
				'dynamic page content',
				
				{'на страницах':
				[
					'основа'
				]},
				
				{облик:
				[
					'form',
					'conditional',
					'scroll navigation',
					
					{окошко:
					[
						 'simple value dialog window'
					]},
						
					'плавающее навершие',
					
					'загрузка, ждите',
					
					'уведомления',
					
					'навершие',
					
					{писарь:
					[
						'editor',
						'time machine',
						'selection',
						'caret'
					]},
						
					{окошко:
					[
						'окошко',
						'z indexer',
						'initializer'
					]},
						
					{кнопки:
					[
						'кнопка',
						'text button',
						'text button skins',
						'image button',
						'image chooser'
					]},
						
					{'наглядный писарь':
					[
						'наглядный писарь',
						'клавиши',
						'снасти'
					]},
						
					{slider:
					[
						'slider',
						'form_slider'
					]},
						
					'сколько уже',
					
					'всплывающее меню',
					
					'подсказки',
					
					'формулы',
		
					'окошко входа'
				]},
				
				'здесь или не здесь',
				
				'youtube',
				'vimeo',
				
				'wiki processor',
				
				'socket.io',
				
				'focus',
				
				'messages',
				'interactive messages',
				
				'data loader',
				'either way loading',
				
				'uploader',
				
				'эфир',
				'новости',
				
				//'tinycon',
				'window notification',
				
				'режимы'
			]
			
			function insert_script(path, callback)
			{
				var has_extension = false
				if (path.lastIndexOf('.js') === path.length - '.js'.length)
					has_extension = true
					
				path = has_extension ? path : path + '.js'
				
				//console.log(path)
					
				$.ajax
				({
					url: add_version(path),
					dataType: "script",
					success: function() { if (callback) callback() },
					error: function()
					{
						if (window.onerror)
							window.onerror()
						else
							alert('Ошибка на странице')
							
						console.log('Page script not loaded (possible syntax error): ' + path)
						//throw 'Ошибка на странице'
					}
				})
			}
			
			var all_scripts = scripts
			
			function insert_scripts(scripts, path)
			{
				if (typeof scripts === 'undefined')
				{
					return insert_scripts(all_scripts, '/javascripts')
				}
				
				if (scripts.length === 0)
				{
					if (all_scripts.length !== 0)
						return insert_scripts()
					
					$(document).trigger('scripts_loaded')
					return
				}
				
				var script = scripts[0]
					
				if (typeof script === 'string')
				{
					scripts.shift()
					return insert_script(path + '/' + script, function() { insert_scripts(scripts, path) })
				}
					
				if (typeof script === 'object')
				{
					var directory
					for (var key in script)
						directory = key
						
					if (!directory || script[directory].length === 0)
					{
						scripts.shift()
						return insert_scripts(scripts, path)
					}
					
					return insert_scripts(script[directory], path + '/' + directory)
				}
			}
		</script>

		<script>
			var styles =
			[
				'общее',
				'messages',
				
				{кнопки:
				[
					'generic',
					'minor',
					'caution'
				]},
					
				'уведомления',
				
				'окошко',
				
				{'наглядный писарь':
				[
					'наглядный писарь',
					'sociopathy',
				]},
				
				'навершие',
				'user icon.less',
				
				'slider',
				
				'окошко входа',
				
				'личная карточка',
				
				'поле поиска',
				
				'audio player'
			]
			
			function insert_style(path)
			{
				var has_extension = false
				if (path.lastIndexOf('.less') === path.length - '.less'.length)
					has_extension = true
				else if (path.lastIndexOf('.css') === path.length - '.css'.length)
					has_extension = true
					
				path = has_extension ? path : path + '.css'
					
				$('<link/>').attr('rel', 'stylesheet/less').attr('href', add_version(path)).appendTo('head')
			}
			
			function insert_styles(styles, path)
			{
				styles.forEach(function(style)
				{
					if (typeof style === 'string')
					{
						return insert_style(path + '/' + style)
					}
						
					if (typeof style === 'object')
						for (var directory in style)
							insert_styles(style[directory], path + '/' + directory)
				})
			}
		</script>
	
		<!-- TeX for Editor -->
		<script type="text/x-mathjax-config">
				MathJax.Hub.Config
				({
					tex2jax:
					{
						processClass: 'tex'
					}
				})
		</script>
		<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

		<!-- XML editor -->
		<link rel="stylesheet" href="/javascripts/codemirror/lib/codemirror.css">
		<script src="/javascripts/codemirror/lib/codemirror.js"></script>
		<script src="/javascripts/codemirror/mode/xml/xml.js"></script>

		<!-- Audio player -->
		<link rel="stylesheet" href="/javascripts/jouele/jouele.css">
		<link id="jouele-swf-object" href="/javascripts/jouele/jplayer.swf">
		<script src="/javascripts/jouele/jquery.jplayer.min.js"></script>
		<script src="/javascripts/jouele/jouele.js"></script>

		<script>
			$.ajax
			({
				url: '/приложение/versioning'
			})
			.success(function(data)
			{
				Version = data.site_version
				//window.versioning = data
				
				if (data.development)
					window.development_mode = true
				
				insert_styles(styles, '/облик')
				insert_scripts()
			})
			.error(function()
			{
				page_loading_error()
			})
		</script>	
		
		 <!-- не убирается в файл, так как less обрабатывает стили при загрузке страницы, поэтому был бы виден мусор -->
		 <style>
			#loading_screen
			{
				position: fixed;
				top: 0;
				left: 0;
				
				z-index: 2;
				
				width: 100%;
				height: 100%;
				
				background-color: #ffffff;
				
				cursor: wait;
				
				text-align: center;
				
				font-family: Arial, sans-serif, Myriad Pro;
				font-size: 30px;
			}
			
			#loading_screen, #loading_screen .content .error.nothing_serious
			{
				color: #bfbfbf;
			}
			
			#loading_screen[status=error]
			{
				cursor: default;
			}
			
			#loading_screen .content .error
			{
				display: inline-block;
				color: #9c4646;
			}
			
			#loading_screen .content .loading
			{
				display: inline-block;
				opacity: 0;
				visibility: hidden;
			}
			
			/*
			.audio_player
			{
				opacity: 0;
			}
			*/
		</style>
		 
		<link id="site_icon" rel="shortcut icon" href="/картинки/значки/основной.png">
		<!--<link rel="shortcut icon" href="/картинки/мигающий значок.gif">-->
	</head>

	<body class="loading">
		<div id="loading_screen">
			<div class="content">
				<img class="loading" src="/картинки/страница загружается.png"/>
				<span class="error" style="display: none">Возможно что-то сломалось</span>
			</div>
		</div>
				
		<aside>
			<nav>
				<!-- top menu panel -->
				<div id="panel">
					<!-- the menu -->
					<ul id="panel_menu">
						<li name="читальня" link="/читальня">Читальня</li>
						<li name="читальня (выбрано)" link="/читальня" hidden="true">Читальня</li>
						
						<li name="люди" link="/люди">Люди</li>
						<li name="люди (выбрано)" link="/люди" hidden="true">Люди</li>
						
						<li name="помощь" link="/помощь">Помощь</li>
						<li name="помощь (выбрано)" link="/помощь" hidden="true">Помощь</li>
					</ul>
					
					<!-- убираем пробелы между элементами -->
					<script>
						var menu = $('#panel_menu')
						var menu_items = menu.children()
						menu.empty().append(menu_items)
					</script>
		
					<!-- logo -->
					<a id="logo" href="/"><img id="panel_logo" src="/картинки/навершие/logo.png"/></a>
				</div>
			</nav>
		</aside>

		<div id="page"></div>
		
		<div class="margin_bug_fixer">&nbsp</div>
				
		<footer></footer>

		<!-- stretches the gradient background to the height of the entire page -->
		<!--<div id="background_stretcher" class="non_selectable"></div>-->
	</body>
</html>