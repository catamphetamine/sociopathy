<!DOCTYPE html>
	
<html lang="ru">
	<head>
		<meta name="author" content="kuchumovn@gmail.com"/> 
		<meta name="designer" content="kuchumovn@gmail.com"/>
		<meta name="copyright" content="2010-2012 Николай Кучумов"/>
		<meta name="description" content="Собрание - общественная сеть"/>
		
		<title>Собрание</title>
		
		<meta charset="utf-8" />
	
		<script src="/javascripts/jquery/jquery.js"></script>
		<script src="/javascripts/jquery/jquery.tmpl.js"></script>

		<script>
			var Configuration = {}
			
			var Version // ex. '1.0.0.0-aplha'
			
			function add_version(url)
			{
				if (!Version)
					throw 'Version not initialized'
				
				 return url + '?version=' + Version
			}

			if (!console)
			{
				console = 
				{
					log: function(message) {},
					error: function(message) {}
				}
			}
			
			function insert_script(path, callback)
			{
				var has_extension = false
				if (path.lastIndexOf('.js') === path.length - '.js'.length)
					has_extension = true
					
				path = has_extension ? path : path + '.js'
				
				console.log('loading script: ' + path)
				
				var options =
				{
					url: add_version(path),
					dataType: "script",
					success: function() { if (callback) callback() },
					error: function()
					{
						if (window.onerror)
							window.onerror()
						else
							alert('Ошибка на странице')
							
						console.error('Page script not loaded (possible syntax error): ' + path)
						//throw 'Ошибка на странице'
					}
				}
					
				if (!window.development_mode)
					options.cache = true
					
				$.ajax(options)
			}

			$(function()
			{
				$.ajax
				({
					url: '/приложение/versioning'
				})
				.success(function(data)
				{
					Version = data.site_version
					//window.versioning = data
					
					if (data.development)
						window.development_mode = true
						
					Configuration.Invites = data.invites
					
					insert_script('/javascripts/root')
				})
				.error(function()
				{
					if (page_loading_error)
						page_loading_error()
					else
						console.error('Ошибка при получении версии сайта')
				})
			})
		</script>
	</head>

	<body>
	</body>
</html>
